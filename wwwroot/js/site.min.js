function getFileSystem(n,t,i,r){$.ajax({url:t,method:"post",data:{path:n},dataType:"json",success:function(n){n.hasOwnProperty("error")?$("#folder-tree").html('<br><div class="alert alert-danger"><strong>Error! <\/strong>'+n.error+"<\/div>"):i(n)},complete:function(n){r(n)}})}function openFileSystemFolder(n,t,i,r){n.off("click",".folder-node");var u=t.data("path")+"/"+t.data("title");i.data("status")==="closed"?(i.data("status","opened"),i.addClass("glyphicon-folder-open").removeClass("glyphicon-folder-close"),getFileSystem(u,r,function(n){var i=generateListHtmlForFileSystem(n,t.data("depth")+1);t.after(i)},function(){letToOpenFileSystemFolder(n,r)})):i.data("status")==="opened"&&(i.data("status","closed"),i.addClass("glyphicon-folder-close").removeClass("glyphicon-folder-open"),$('li[data-path^="'+u+'"]').remove(),letToOpenFileSystemFolder(n,r))}function letToOpenFileSystemFolder(n,t){n.on("click",".folder-node",function(){var i=$(this).closest("li"),r=$(this);openFileSystemFolder(n,i,r,t)})}function generateListHtmlForFileSystem(n,t){var i="",r=t*"20";return $.each(n,function(n,u){if(i+='<li class="list-group-item node-tree" data-path="'+u.path+'" data-title="'+u.title+'" data-depth="'+t+'">',i+=u.type==="folder"?'<div class="folder-node glyphicon glyphicon-folder-close text-right" style="width: '+r+'px;" data-status="closed"><\/div>':'<div class="file-node glyphicon" style="width: '+r+'px;"><\/div>',i+='<span class="icon node-icon"><\/span>'+u.title,u.type==="file"){var f="/Upload/DownloadFile?"+$.param({path:u.path,fileName:u.title});i+='<a class="pull-right" href="'+f+'">Download<\/a>'}i+="<\/li>"}),i}function openFolderTreeFolder(n,t,i,r){n.off("click",".folder-node");var u=t.data("path")+"/"+t.data("title");i.data("status")==="closed"?(i.data("status","opened"),i.addClass("glyphicon-folder-open").removeClass("glyphicon-folder-close"),getFileSystem(u,r,function(n){var i=generateListHtmlForFileTree(n,t.data("depth")+1);t.after(i)},function(){letToOpenFolderTreeFolder(n,r)})):i.data("status")==="opened"&&(i.data("status","closed"),i.addClass("glyphicon-folder-close").removeClass("glyphicon-folder-open"),$('li[data-path^="'+u+'"]').remove(),letToOpenFolderTreeFolder(n,r))}function letToOpenFolderTreeFolder(n,t){n.on("click",".folder-node",function(){var i=$(this).closest("li"),r=$(this);openFolderTreeFolder(n,i,r,t)})}function generateListHtmlForFileTree(n,t){var i="",r=t*"20";return $.each(n,function(n,u){i+='<li class="list-group-item node-tree" data-path="'+u.path+'" data-title="'+u.title+'" data-depth="'+t+'">';i+='<div class="folder-node glyphicon glyphicon-folder-close text-right" style="width: '+r+'px;" data-status="closed"><\/div>';i+='<span class="icon node-icon"><\/span>'+u.title;i+='<input type="radio" name="uploadPath" class="pull-right" value="'+u.path+"/"+u.title;i+='"><\/li>'}),i}$(function(){Dropzone.options.fileUploadForm={autoProcessQueue:!1,maxFilesize:5,addRemoveLinks:!0,parallelUploads:5,init:function(){var n=this,t;n.options.addRemoveLinks=!0;n.options.dictRemoveFile="Remove";n.on("sending",function(n,t,i){var r=$("input[name=uploadPath]:checked","#folder-tree").val();r&&i.append("uploadPath",r)});t=document.querySelector("#upload-button");t.addEventListener("click",function(){n.processQueue()})}}});$(function(){var n=$("#tree"),t;n.length&&(t="/Home/ListFoldersAndFiles",getFileSystem("",t,function(t){var i=generateListHtmlForFileSystem(t,1);n.html("<ul>"+i+"<\/ul>")},function(){}),letToOpenFileSystemFolder(n,t))});$(function(){var n=$("#folder-tree"),t;n.length&&(t="/Home/ListFolders",getFileSystem("",t,function(t){var i='<li style="background:#ddf0ff;" class="list-group-item node-tree" data-path="" data-title="root" data-depth="0"><div class="glyphicon glyphicon-folder-open text-muted text-right"style="width:20px;margin-right: 15px;" data-status="closed"><\/div><span class="icon node-icon"><\/span>/<input type="radio" name="uploadPath" class="pull-right" value="" checked="checked"><\/li>';i+=generateListHtmlForFileTree(t,1);n.html("<ul>"+i+"<\/ul>")},function(){}),letToOpenFolderTreeFolder(n,t))});